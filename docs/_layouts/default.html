<!DOCTYPE html>
<html>
  <head>
    <script type="importmap">
      {
        "imports": {
          "vue": "https://jspm.dev/vue/dist/vue.js"
        }
      }
    </script>
    <style>
      body{
        font-family: Arial, Helvetica, sans-serif;
      }
      html {
        box-sizing: border-box;
      }
      *, *:before, *:after {
        box-sizing: inherit;
      }
      .aws-action {
        font-family: 'Courier New', Courier, monospace;
        padding: 2px 0px 2px 22px;
        position: relative;
      }
      .bubble {
        border-radius: 8px;
        background: rgb(238, 238, 238);
        display: inline-block;
        padding: 4px 8px;
        font-size: 11px;
      }
      a {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <section id="main" role="main">
      <div style="width:640px;margin:0 auto;">
        {% raw %}
        <div id="container" style="display:none">
            <span class="bubble"  v-text="filteredItems.length"></span>
            <input v-model="filter" autofocus style="display:block;width:100%;padding:8px;">
            <div style="padding:16px;background:#eee">
              <div class="aws-action" v-for="item in filteredItems">
                <span>{{ item.action }}</span>
                <a :href="item.url" style="font-size:160%;position: absolute;left:-4px;top:-4px">
                  &#9756;
                </a>
              </div>
            </div>
        </div>
        {% endraw %}
      </div>
    </section>
    <script type="module">
      import Vue from 'vue';

      function actionToData(serviceUrls) {
        return function(action) {
          const svc = action.split(":")[0];
          return {
            action,
            svc,
            url: serviceUrls[svc],
          }
        }
      }
      const awsData = "{{ site.baseurl }}/aws";
      new Vue({
          el: '#container',
          created() {
              const self = this;
              fetch(awsData + "/actions.json")
                  .then((response) => response.json())
                  .then((data) => {
                      self.items = data;
                      self.message = "Done!";
                  });

              fetch(awsData + "/service_urls.json")
                  .then((response) => response.json())
                  .then((data) => {
                      self.serviceUrls = data;
                  });
          },
          computed: {
            filteredItems() {
              if (this.filter.length < 2) {
                return this.items.map(actionToData(this.serviceUrls));
              }
              const queries = this.filter.split(" ").map(e => e.trim()).filter(e => !!e);
              const count = queries.length;
              return this.items
                .filter(i => queries.filter(q => i.toLowerCase().indexOf(q) !== -1).length === count)
                .map(actionToData(this.serviceUrls))
            }
          },
          data() {
              return {
                  serviceUrls: {},
                  filter: '',
                  items: [],
                  message: '...loading'
              }
          }
      });
      container.style.display = "block"
    </script>
  </body>

</html>